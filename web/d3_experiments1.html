<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <title>d3 experiment1</title>
    <script type="text/javascript"
            src="https://raw.github.com/mbostock/d3/master/d3.js">
    </script>
    <script type="text/javascript"
            src="http://docs.sencha.com/extjs/4.2.1/extjs-build/ext-all.js">
    </script>

    <style type="text/css">
      .box {
        background-color: skyblue;
        width: 24px;
        height: 18px;
        padding: 4px;
        margin: 1px;
      }
    </style>

  </head>
  <body>
      <script type="text/javascript">

//       var computer = "";

              var computer =[{
        "from_id": "0",
        "to_id": "0",
        "value":0
    },
{
        "from_id": "0",
        "to_id": "1",
        "value":5871
},
{
       "from_id": "0",
        "to_id": "2",
        "value":8916
},
{
       "from_id": "0",
        "to_id": "3",
        "value":2868
},
{
       "from_id": "1",
        "to_id": "0",
        "value":1951
},
{
       "from_id": "1",
        "to_id": "1",
        "value":0
},
{
       "from_id": "1",
        "to_id": "2",
        "value":200
},
{
       "from_id": "1",
        "to_id": "3",
        "value":6171
},
{
       "from_id": "2",
        "to_id": "0",
        "value":8010
},
{
      "from_id": "2",
        "to_id": "1",
        "value":1614
},
{
      "from_id": "2",
        "to_id": "2",
        "value":0
},
{
      "from_id": "2",
        "to_id": "3",
        "value":8045
},
{
      "from_id": "3",
        "to_id": "0",
        "value":1013
},
{
      "from_id": "3",
        "to_id": "1",
        "value":990
},
{
      "from_id": "3",
        "to_id": "2",
        "value":940
},
{
      "from_id": "3",
        "to_id": "3",
        "value":0
}
];


    function loaddata( matrix){

    var width = 960,
            height = 500,
            innerRadius = Math.min(width, height) * .41,
            outerRadius = innerRadius * 1.1;

    var fill =["#000000", "#FFDD89", "#957244", "#F26223"];//ÑÕÉ«Êý×é

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
    var chord = d3.layout.chord()
            .padding(.05)
            .sortSubgroups(d3.descending)
            .matrix(matrix);
    svg.append("g").selectAll("path")
            .data(chord.groups)
            .enter().append("path")
            .style("fill", function(d) { return fill[d.index] })
            .style("stroke", function(d) { return fill[d.index]; })
            .attr("d", d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius));
    svg.append("g")
            .attr("class", "chord")
            .selectAll("path")
            .data(chord.chords)
            .enter().append("path")
            .attr("fill-opacity",.67)
            .attr("stroke","#000")
            .attr("stroke-width",.5)
            .attr("d", d3.svg.chord().radius(innerRadius))
            .style("fill", function(d) { return fill[d.target.index]; })
            .style("opacity", 1);
   
     }
       var requestConfig = {  
        url :'http://127.0.0.1:8085/dataflow', 
        callback : function(options,success,response){
            var msg = ["is:" ,success,"/n",  
                        "return:",response.responseText];  
            alert(msg.join(''));
            var jsondata = Ext.JSON.decode(response.responseText);
            //var jsonstring = Ext.JSON.encode(computer);
            //var jsondata2 = Ext.JSON.decode(jsonstring);
            //alert(jsonstring);
            //alert(jsondata.info);
            //loaddata(jsondata.info); 
            getMatrix(jsondata.info) 
        }  
    }
    function getMatrix(dataflowlist){
      alert(dataflowlist);
      var serverList=new Array();
      for(var i=0;i<dataflowlist.length;i++){
        //alert(dataflowlist[i]);
        //for(j in dataflowlist[i]){
        //  alert(j);//i就是test的属性名
        //  alert(dataflowlist[i].j);//test.i就是属性值
        //}
        serverList.push(dataflowlist[i].src);
        serverList.push(dataflowlist[i].dest);
      }
      alert(serverList);
      var uniqueList = Ext.Array.unique(serverList); 
      alert(uniqueList);
      var serverCount = uniqueList.length
      var newMatrix = new Array();
      for(var i=0;i<serverCount;i++){
        newMatrix.push(new Array());
        for(var j=0;j<serverCount;j++){
          newMatrix[i][j]=10;
        }
      }
      loaddata(newMatrix);
      alert(newMatrix);
      for(var i=0;i<dataflowlist.length;i++){
        serverFrom=dataflowlist[i].src;
        //dataflowlist[i].dest);
      }
    }
    Ext.Ajax.request(requestConfig);   
    </script>

  </body>
</html>
